# 개발 환경 설정
# 이 파일은 dev profile 활성화 시 사용됩니다.
#
# 사용 방법:
# export SPRING_PROFILES_ACTIVE=dev

server:
  port: 8080

spring:
  application:
    name: dwp-gateway
  main:
    web-application-type: reactive
  cloud:
    gateway:
      routes:
        # 개발 환경: 로컬호스트 사용
        # HITL API 라우팅 (Main Service)
        - id: hitl-api
          uri: http://localhost:8081
          predicates:
            - Path=/api/aura/hitl/**
          filters:
            - StripPrefix=1
        # Aura Dashboard → SynapseX 프록시 (Aura 전달사항)
        - id: aura-dashboard-synapsex
          uri: ${SERVICE_SYNAPSEX_URL:http://localhost:8085}
          order: -1
          predicates:
            - Path=/api/aura/dashboard/**
          filters:
            - RewritePath=/api/aura/dashboard(?<segment>.*), /synapse/dashboard$\{segment}
        # Aura Platform (AI Agent) 라우팅 - 개발 환경
        # ✅ 포트 9000 확정: Aura-Platform은 포트 9000을 사용합니다
        - id: aura-platform
          uri: ${AURA_PLATFORM_URI:http://localhost:9000}  # ✅ 포트 9000 확정
          predicates:
            - Path=/api/aura/**
          filters:
            - StripPrefix=1
            - PreserveHostHeader
        - id: main-service
          uri: http://localhost:8081
          predicates:
            - Path=/api/main/**
          filters:
            - StripPrefix=1
        # Monitoring 수집 API 라우팅 (Auth Server)
        - id: monitoring-collect
          uri: http://localhost:8001
          predicates:
            - Path=/api/monitoring/**
          filters:
            - StripPrefix=1  # /api/monitoring/** → /monitoring/**로 변환
        # SynapseX Service (Admin/통화·PII 정책, Audit 감사로그) - /api/synapse/**
        - id: synapsex-admin
          uri: ${SERVICE_SYNAPSEX_URL:http://localhost:8085}
          predicates:
            - Path=/api/synapse/admin/**
          filters:
            - StripPrefix=1
        - id: synapsex-audit
          uri: ${SERVICE_SYNAPSEX_URL:http://localhost:8085}
          predicates:
            - Path=/api/synapse/audit/**
          filters:
            - StripPrefix=1
        - id: synapsex-entities
          uri: ${SERVICE_SYNAPSEX_URL:http://localhost:8085}
          predicates:
            - Path=/api/synapse/entities/**
          filters:
            - StripPrefix=1
        - id: synapsex-integration
          uri: ${SERVICE_SYNAPSEX_URL:http://localhost:8085}
          predicates:
            - Path=/api/synapse/integration/**
          filters:
            - StripPrefix=1
        - id: synapsex-documents
          uri: ${SERVICE_SYNAPSEX_URL:http://localhost:8085}
          predicates:
            - Path=/api/synapse/documents/**
          filters:
            - StripPrefix=1
        - id: synapsex-open-items
          uri: ${SERVICE_SYNAPSEX_URL:http://localhost:8085}
          predicates:
            - Path=/api/synapse/open-items/**
          filters:
            - StripPrefix=1
        - id: synapsex-lineage
          uri: ${SERVICE_SYNAPSEX_URL:http://localhost:8085}
          predicates:
            - Path=/api/synapse/lineage/**
          filters:
            - StripPrefix=1
        - id: synapsex-cases
          uri: ${SERVICE_SYNAPSEX_URL:http://localhost:8085}
          predicates:
            - Path=/api/synapse/cases/**
          filters:
            - StripPrefix=1
        - id: synapsex-dashboard
          uri: ${SERVICE_SYNAPSEX_URL:http://localhost:8085}
          predicates:
            - Path=/api/synapse/dashboard/**
          filters:
            - StripPrefix=1
        - id: synapsex-anomalies
          uri: ${SERVICE_SYNAPSEX_URL:http://localhost:8085}
          predicates:
            - Path=/api/synapse/anomalies/**
          filters:
            - StripPrefix=1
        - id: synapsex-actions
          uri: ${SERVICE_SYNAPSEX_URL:http://localhost:8085}
          predicates:
            - Path=/api/synapse/actions/**
          filters:
            - StripPrefix=1
        - id: synapsex-archive
          uri: ${SERVICE_SYNAPSEX_URL:http://localhost:8085}
          predicates:
            - Path=/api/synapse/archive/**
          filters:
            - StripPrefix=1
        # Phase 3: RAG, Policies, Guardrails, Dictionary, Feedback
        - id: synapsex-rag
          uri: ${SERVICE_SYNAPSEX_URL:http://localhost:8085}
          predicates:
            - Path=/api/synapse/rag/**
          filters:
            - StripPrefix=1
        - id: synapsex-policies
          uri: ${SERVICE_SYNAPSEX_URL:http://localhost:8085}
          predicates:
            - Path=/api/synapse/policies/**
          filters:
            - StripPrefix=1
        - id: synapsex-guardrails
          uri: ${SERVICE_SYNAPSEX_URL:http://localhost:8085}
          predicates:
            - Path=/api/synapse/guardrails/**
          filters:
            - StripPrefix=1
        - id: synapsex-dictionary
          uri: ${SERVICE_SYNAPSEX_URL:http://localhost:8085}
          predicates:
            - Path=/api/synapse/dictionary/**
          filters:
            - StripPrefix=1
        - id: synapsex-feedback
          uri: ${SERVICE_SYNAPSEX_URL:http://localhost:8085}
          predicates:
            - Path=/api/synapse/feedback/**
          filters:
            - StripPrefix=1
        # Phase 4: Reconciliation, Action-recon, Analytics
        - id: synapsex-reconciliation
          uri: ${SERVICE_SYNAPSEX_URL:http://localhost:8085}
          predicates:
            - Path=/api/synapse/reconciliation/**
          filters:
            - StripPrefix=1
        - id: synapsex-action-recon
          uri: ${SERVICE_SYNAPSEX_URL:http://localhost:8085}
          predicates:
            - Path=/api/synapse/action-recon/**
          filters:
            - StripPrefix=1
        - id: synapsex-analytics
          uri: ${SERVICE_SYNAPSEX_URL:http://localhost:8085}
          predicates:
            - Path=/api/synapse/analytics/**
          filters:
            - StripPrefix=1
        - id: synapsex-optimization
          uri: ${SERVICE_SYNAPSEX_URL:http://localhost:8085}
          predicates:
            - Path=/api/synapse/optimization/**
          filters:
            - StripPrefix=1
        # Agent Tool API (Aura 호출용)
        - id: synapsex-agent-tools
          uri: ${SERVICE_SYNAPSEX_URL:http://localhost:8085}
          predicates:
            - Path=/api/synapse/agent-tools/**
          filters:
            - StripPrefix=1
        - id: auth-server
          uri: http://localhost:8001  # Auth Server 포트 변경 (8000 → 8001)
          predicates:
            - Path=/api/auth/**
          filters:
            - StripPrefix=1
        # Admin API 라우팅 (Auth Server) - Admin CRUD 및 모니터링 조회 API
        - id: admin-api
          uri: http://localhost:8001
          predicates:
            - Path=/api/admin/**
          filters:
            - StripPrefix=1  # /api/admin/** → /admin/**로 변환
        - id: mail-service
          uri: http://localhost:8082
          predicates:
            - Path=/api/mail/**
          filters:
            - StripPrefix=1
        - id: chat-service
          uri: http://localhost:8083
          predicates:
            - Path=/api/chat/**
          filters:
            - StripPrefix=1
        - id: approval-service
          uri: http://localhost:8084
          predicates:
            - Path=/api/approval/**
          filters:
            - StripPrefix=1

# 개발 환경 CORS 설정
# 기본값: http://localhost:4200 (Angular 기본 포트)
cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:4200,http://localhost:3000}
  allowed-methods: ${CORS_ALLOWED_METHODS:GET,POST,PUT,DELETE,PATCH,OPTIONS}
  allowed-headers: ${CORS_ALLOWED_HEADERS:*}
  allow-credentials: ${CORS_ALLOW_CREDENTIALS:true}
  max-age: ${CORS_MAX_AGE:3600}

logging:
  level:
    '[org.springframework.cloud.gateway]': DEBUG
    '[org.springframework.web]': DEBUG
    '[com.dwp.gateway]': DEBUG
